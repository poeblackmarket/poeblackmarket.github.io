function parseSearchInput(e,t){terms=e;var r=/([^\s]*=\".*?\")/g,n=t.match(r);n=expandLsts(n);var a=t.replace(r,"LST"),s=parseSearchInputTokens(a),o=0,i=s.replace("LST",function(e){var t=n[o];return o++,t});return i}function expandLsts(e){return e}function parseSearchInputTokens(e){var t=e.split(" "),r=[];for(i in t){var n=t[i],a=n;"OR"!=n&&"AND"!=n&&"LST"!=n&&(a=evalSearchTerm(n),a&&hasBackTick(a)&&(a=parseSearchInputTokens(a))),r.push(a)}var s=r.join(" ");return s}function evalSearchTerm(e){var t="";for(regex in terms)if(terms.hasOwnProperty(regex)){var r=new RegExp("^"+regex+"$","i"),n=removeParensAndBackTick(e),a=r.test(n);if(a){t=terms[regex].query,t=n.replace(r,t),t=escapeField(t),hasOpenParen(e)&&(t="("+t),hasCloseParen(e)&&(t+=")");break}}return t}function removeParensAndBackTick(e){var t=e.replace(/[\(\)`]/g,"");return t}function hasOpenParen(e){return e.startsWith("(")}function hasCloseParen(e){return e.endsWith(")")}function hasBackTick(e){return-1!=e.indexOf("`")}function escapeField(e){var t=e,r=e.indexOf(":");if(-1!=r){var n=t.substr(0,r);t=t.replace(n,n.replace(/\s/g,"\\ "))}return t}var terms={};!function(){"use strict";function e(e,t){e.otherwise("/"),t.html5Mode({enabled:!1,requireBase:!1}),t.hashPrefix("!")}function t(){FastClick.attach(document.body)}var r=angular.module("application",["elasticsearch","ui.router","ngAnimate","foundation","foundation.dynamicRouting","foundation.dynamicRouting.animations"]);r.config(e),r.run(t),e.$inject=["$urlRouterProvider","$locationProvider"],r.service("es",function(e){return e({host:"http://apikey:07e669ae1b2a4f517d68068a8e24cfe4@api.exiletools.com"})}),r.controller("SearchController",["$scope","$http","es",function(e,t,r){e.searchInput="3s2l",e.queryString="",e.termsMap={};var n=function(t){var r=jsyaml.load(t.data);jQuery.extend(e.termsMap,r)};t.get("assets/terms/itemtypes.yml").then(n),t.get("assets/terms/gems.yml").then(n),t.get("assets/terms/mod-ofs.yml").then(n),t.get("assets/terms/mod-def.yml").then(n),t.get("assets/terms/mod-vaal.yml").then(n),t.get("assets/terms/attributes.yml").then(n),t.get("assets/terms/sockets.yml").then(n),t.get("assets/terms/buyout.yml").then(n),e.doSearch=function(){e.Response=null;var t=parseSearchInput(e.termsMap,e.searchInput);console.log("searchQuery="+t),e.queryString=t,r.search({index:"index",body:{sort:[{"shop.updated":{order:"desc"}}],query:{query_string:{default_operator:"AND",query:t}},size:100}}).then(function(t){e.Response=t},function(e){console.trace(e.message)})}}]),r.directive("myEnter",function(){return function(e,t,r){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(r.myEnter)}),t.preventDefault())})}})}();